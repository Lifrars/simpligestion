"use strict";(self.webpackChunkvex=self.webpackChunkvex||[]).push([[5463],{5463:(K,_,l)=>{l.r(_),l.d(_,{ClientesComponent:()=>V});var x=l(617),p=l(2296),D=l(97),S=l(9565),c=l(5313),T=l(1476),C=l(3566),h=l(5195),u=l(4170),g=l(4516),N=l(8525),q=l(3680),m=l(9347),s=l(6223),A=l(6814),E=l(3519),f=l.n(E),e=l(9212),b=l(9862);let U=(()=>{class n{constructor(t){this.http=t,this.apiUrl="https://ppi.miclickderecho.com/plantilla/MomentoValorativo2/api_pipe/api.php"}getClientes(){return this.http.get(`${this.apiUrl}?obtenerClientess=true`)}addCliente(t){const i=new b.WM({"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}?agregarCliente=true`,t,{headers:i})}updateCliente(t){const i=new b.WM({"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}?actualizarCliente=true&id_cliente=${t.id_cliente}`,t,{headers:i})}deleteCliente(t){return this.http.delete(`${this.apiUrl}?eliminarCliente=true&id_cliente=${t}`)}static#e=this.\u0275fac=function(i){return new(i||n)(e.LFG(b.eN))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),v=(()=>{class n{constructor(t,i,o,a){this.dialogRef=t,this.fb=i,this.clienteService=o,this.data=a,this.isEditMode=!1,this.clienteForm=this.fb.group({cedula:[this.data?.cliente?.cedula||"",s.kI.required],nombres:[this.data?.cliente?.nombres||"",s.kI.required],apellidos:[this.data?.cliente?.apellidos||"",s.kI.required],direccion:[this.data?.cliente?.direccion||"",s.kI.required],telefono:[this.data?.cliente?.telefono||"",s.kI.required]})}onCancel(){this.dialogRef.close()}onSave(){this.clienteForm.valid&&this.agregarCliente()}agregarCliente(){this.clienteService.addCliente(this.clienteForm.value).subscribe(t=>{t.success&&f().fire({icon:"success",title:"\xa1Cliente agregado!",text:"El cliente se agreg\xf3 correctamente a la base de datos",confirmButtonText:"Ok"}).then(()=>{this.dialogRef.close(),window.location.reload()})},t=>{console.error("Error al agregar el cliente",t),f().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al intentar agregar el cliente. Por favor, int\xe9ntalo de nuevo.",confirmButtonText:"Ok"})})}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(m.so),e.Y36(s.qu),e.Y36(U),e.Y36(m.WI))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-add-cliente-dialog"]],standalone:!0,features:[e.jDz],decls:33,vars:3,consts:[["mat-dialog-title",""],[1,"scrollable-content"],[3,"formGroup"],[1,"form-grid"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","cedula","required",""],["matInput","","formControlName","nombres","required",""],["matInput","","formControlName","apellidos","required",""],["matInput","","formControlName","direccion","required",""],["matInput","","formControlName","telefono","required",""],["align","end"],["mat-button","",3,"click"],["mat-button","","color","primary",3,"disabled","click"]],template:function(i,o){1&i&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"div",3)(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),e._uU(8,"C\xe9dula"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.TgZ(10,"mat-form-field",5)(11,"mat-label"),e._uU(12,"Nombres"),e.qZA(),e._UZ(13,"input",7),e.qZA()(),e.TgZ(14,"div",4)(15,"mat-form-field",5)(16,"mat-label"),e._uU(17,"Apellidos"),e.qZA(),e._UZ(18,"input",8),e.qZA(),e.TgZ(19,"mat-form-field",5)(20,"mat-label"),e._uU(21,"Direcci\xf3n"),e.qZA(),e._UZ(22,"input",9),e.qZA()(),e.TgZ(23,"div",4)(24,"mat-form-field",5)(25,"mat-label"),e._uU(26,"Tel\xe9fono"),e.qZA(),e._UZ(27,"input",10),e.qZA()()()()(),e.TgZ(28,"mat-dialog-actions",11)(29,"button",12),e.NdJ("click",function(){return o.onCancel()}),e._uU(30,"Cancelar"),e.qZA(),e.TgZ(31,"button",13),e.NdJ("click",function(){return o.onSave()}),e._uU(32," Guardar "),e.qZA()()),2&i&&(e.xp6(),e.Oqu(o.data.cliente?"Editar Cliente":"Agregar Cliente"),e.xp6(2),e.Q6J("formGroup",o.clienteForm),e.xp6(28),e.Q6J("disabled",o.clienteForm.invalid))},dependencies:[m.Is,m.uh,m.H8,m.xY,u.lN,u.KE,u.hX,g.c,g.Nt,p.ot,p.lW,s.UX,s._Y,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u,A.ez],styles:['@charset "UTF-8";.scrollable-content[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;padding-right:16px}.form-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px}.form-field[_ngcontent-%COMP%]{flex:1}']})}return n})();var w=l(217),M=l(376);function F(n,r){1&n&&(e.TgZ(0,"th",26),e._uU(1," ID "),e.qZA())}function J(n,r){if(1&n&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(),e.hij(" ",t.id_cliente," ")}}function R(n,r){1&n&&(e.TgZ(0,"th",26),e._uU(1," C\xe9dula "),e.qZA())}function Y(n,r){if(1&n&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(),e.hij(" ",t.cedula," ")}}function B(n,r){1&n&&(e.TgZ(0,"th",26),e._uU(1," Nombres "),e.qZA())}function I(n,r){if(1&n&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(),e.hij(" ",t.nombres," ")}}function Q(n,r){1&n&&(e.TgZ(0,"th",26),e._uU(1," Apellidos "),e.qZA())}function O(n,r){if(1&n&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(),e.hij(" ",t.apellidos," ")}}function k(n,r){1&n&&(e.TgZ(0,"th",26),e._uU(1," Direcci\xf3n "),e.qZA())}function j(n,r){if(1&n&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(),e.hij(" ",t.direccion," ")}}function z(n,r){1&n&&(e.TgZ(0,"th",26),e._uU(1," Tel\xe9fono "),e.qZA())}function $(n,r){if(1&n&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(),e.hij(" ",t.telefono," ")}}function G(n,r){1&n&&(e.TgZ(0,"th",28),e._uU(1," Acciones "),e.qZA())}function P(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td",27)(1,"button",29),e.NdJ("click",function(){const a=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.eliminarCliente(a.id_cliente))}),e.TgZ(2,"mat-icon"),e._uU(3,"delete"),e.qZA()()()}}function H(n,r){1&n&&e._UZ(0,"tr",30)}function W(n,r){1&n&&e._UZ(0,"tr",31)}const L=()=>["Dashboards","Clientes"],X=()=>[5,10,20];let V=(()=>{class n{constructor(t,i,o){this.configService=t,this.dashboardService=i,this.dialog=o,this.searchTerm="",this.displayedColumns=["id_cliente","cedula","nombres","apellidos","direccion","telefono","acciones"],this.dataSource=new c.by}ngOnInit(){this.footerVisibleChange(!1),this.obtenerClientes()}obtenerClientes(){this.dashboardService.getClientes().subscribe(t=>{t&&Array.isArray(t.clientes)&&(this.dataSource.data=t.clientes,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)},t=>{console.error("Error al obtener los clientes",t),this.dataSource.data=[]})}applyFilter(){this.dataSource.filterPredicate=(t,i)=>t.nombres.toLowerCase().includes(this.searchTerm.toLowerCase()),this.dataSource.filter=this.searchTerm.trim().toLowerCase()}onSearchTermChange(){this.applyFilter()}footerVisibleChange(t){this.configService.updateConfig({footer:{visible:!1}})}generarReporte(){const t=this.dataSource.filteredData.map(a=>({ID:a.id_cliente,C\u00e9dula:a.cedula,Nombres:a.nombres,Apellidos:a.apellidos,Direcci\u00f3n:a.direccion,Tel\u00e9fono:a.telefono})),i=this.convertToCSV(t),o=new Blob([i],{type:"text/csv;charset=utf-8;"});(0,w.saveAs)(o,"reporte_clientes.csv")}convertToCSV(t){const i="object"!=typeof t?JSON.parse(t):t;let o="",a="";for(const d in i[0])i[0].hasOwnProperty(d)&&(a+=d+",");a=a.slice(0,-1),o+=a+"\r\n";for(let d=0;d<i.length;d++){let Z="";for(const y in i[d])i[d].hasOwnProperty(y)&&(Z+=i[d][y]+",");Z=Z.slice(0,-1),o+=Z+"\r\n"}return o}agregarCliente(){this.dialog.open(v,{width:"400px"}).afterClosed().subscribe(i=>{i&&this.dashboardService.addCliente(i).subscribe(()=>{this.obtenerClientes()},o=>{console.error("Error al agregar el cliente",o)})})}openEditClienteModal(t){this.dialog.open(v,{width:"800px",data:{cliente:t}}).afterClosed().subscribe(o=>{o&&this.dashboardService.updateCliente(o).subscribe(()=>{f().fire("Actualizado","El cliente ha sido actualizado correctamente.","success"),this.obtenerClientes()},a=>{f().fire("Error","Ocurri\xf3 un error al intentar actualizar el cliente.","error")})})}eliminarCliente(t){f().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"}).then(i=>{i.isConfirmed&&this.dashboardService.deleteCliente(t).subscribe(()=>{f().fire("Eliminado","El cliente ha sido eliminado correctamente.","success"),this.obtenerClientes()},o=>{console.error("Error al eliminar el cliente",o),f().fire("Error","Ocurri\xf3 un error al intentar eliminar el cliente.","error")})})}openAddClienteModal(){this.dialog.open(v,{width:"800px",data:{}}).afterClosed().subscribe(i=>{i&&this.obtenerClientes()})}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(M.Y),e.Y36(U),e.Y36(m.uw))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["vex-clientes"]],viewQuery:function(i,o){if(1&i&&(e.Gf(T.NW,5),e.Gf(C.YE,5)),2&i){let a;e.iGM(a=e.CRH())&&(o.paginator=a.first),e.iGM(a=e.CRH())&&(o.sort=a.first)}},standalone:!0,features:[e.jDz],decls:53,vars:8,consts:[["current","Clientes"],[1,"flex-auto",3,"crumbs"],["color","primary","mat-icon-button","","type","button",1,"ml-2"],["svgIcon","mat:add"],[1,"container","p-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-semibold","text-gray-700"],["mat-flat-button","","color","primary",3,"click"],["appearance","outline"],["matInput","","placeholder","Buscar...",3,"ngModel","ngModelChange"],["matSuffix",""],["mat-flat-button","","color","accent",3,"click"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id_cliente"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","cedula"],["matColumnDef","nombres"],["matColumnDef","apellidos"],["matColumnDef","direccion"],["matColumnDef","telefono"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,o){1&i&&(e.TgZ(0,"vex-secondary-toolbar",0),e._UZ(1,"vex-breadcrumbs",1),e.TgZ(2,"button",2),e._UZ(3,"mat-icon",3),e.qZA()(),e.TgZ(4,"div",4)(5,"div",5)(6,"h2",6),e._uU(7,"Informaci\xf3n de Clientes"),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){return o.openAddClienteModal()}),e.TgZ(9,"mat-icon"),e._uU(10,"add"),e.qZA(),e._uU(11," Agregar Cliente "),e.qZA()(),e.TgZ(12,"mat-card")(13,"mat-card-header")(14,"mat-card-title"),e._uU(15,"B\xfasqueda de Clientes"),e.qZA()(),e.TgZ(16,"mat-card-content")(17,"div",5)(18,"mat-form-field",8)(19,"mat-label"),e._uU(20,"Buscar por nombre"),e.qZA(),e.TgZ(21,"input",9),e.NdJ("ngModelChange",function(d){return o.searchTerm=d})("ngModelChange",function(){return o.onSearchTermChange()}),e.qZA(),e.TgZ(22,"mat-icon",10),e._uU(23,"search"),e.qZA()(),e.TgZ(24,"button",11),e.NdJ("click",function(){return o.generarReporte()}),e.TgZ(25,"mat-icon"),e._uU(26,"download"),e.qZA(),e._uU(27," Generar Reporte "),e.qZA()(),e.TgZ(28,"table",12),e.ynx(29,13),e.YNc(30,F,2,0,"th",14)(31,J,2,1,"td",15),e.BQk(),e.ynx(32,16),e.YNc(33,R,2,0,"th",14)(34,Y,2,1,"td",15),e.BQk(),e.ynx(35,17),e.YNc(36,B,2,0,"th",14)(37,I,2,1,"td",15),e.BQk(),e.ynx(38,18),e.YNc(39,Q,2,0,"th",14)(40,O,2,1,"td",15),e.BQk(),e.ynx(41,19),e.YNc(42,k,2,0,"th",14)(43,j,2,1,"td",15),e.BQk(),e.ynx(44,20),e.YNc(45,z,2,0,"th",14)(46,$,2,1,"td",15),e.BQk(),e.ynx(47,21),e.YNc(48,G,2,0,"th",22)(49,P,4,0,"td",15),e.BQk(),e.YNc(50,H,1,0,"tr",23)(51,W,1,0,"tr",24),e.qZA(),e._UZ(52,"mat-paginator",25),e.qZA()()()),2&i&&(e.xp6(),e.Q6J("crumbs",e.DdM(6,L)),e.xp6(20),e.Q6J("ngModel",o.searchTerm),e.xp6(7),e.Q6J("dataSource",o.dataSource),e.xp6(22),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(),e.Q6J("matRowDefColumns",o.displayedColumns),e.xp6(),e.Q6J("pageSizeOptions",e.DdM(7,X)))},dependencies:[S.P,D.D,p.ot,p.lW,p.RK,x.Ps,x.Hw,c.p0,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,h.QW,h.a8,h.dn,h.dk,h.n5,T.TU,T.NW,C.JX,C.YE,C.nU,u.lN,u.KE,u.hX,u.R9,g.c,g.Nt,N.LD,q.Ng,s.u5,s.Fj,s.JJ,s.On,A.ez,m.Is]})}return n})()}}]);