"use strict";(self.webpackChunkvex=self.webpackChunkvex||[]).push([[770],{770:(W,T,r)=>{r.r(T),r.d(T,{MedicamentoComponent:()=>H});var b=r(617),p=r(2296),_=r(97),y=r(9565),d=r(5313),Z=r(1476),g=r(3566),f=r(5195),u=r(4170),C=r(4516),D=r(8525),S=r(3680),l=r(9347),c=r(6223),x=r(6814),N=r(3519),h=r.n(N),e=r(9212),v=r(9862);let A=(()=>{class o{constructor(t){this.http=t,this.apiUrl="https://ppi.miclickderecho.com/plantilla/MomentoValorativo2/api_pipe/api.php"}getMedicamentos(){return this.http.get(`${this.apiUrl}?obtenerMedicamentoss=true`)}addMedicamento(t){const n=new v.WM({"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}?agregarMedicamento=true`,t,{headers:n})}updateMedicamento(t){const n=new v.WM({"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}?actualizarMedicamento=true&id_medicamento=${t.id_medicamento}`,t,{headers:n})}deleteMedicamento(t){return this.http.delete(`${this.apiUrl}?eliminarMedicamento=true&id_medicamento=${t}`)}static#e=this.\u0275fac=function(n){return new(n||o)(e.LFG(v.eN))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),w=(()=>{class o{constructor(t,n,a,i){this.dialogRef=t,this.fb=n,this.medicamentoService=a,this.data=i,this.isEditMode=!1,this.medicamentoForm=this.fb.group({nombre:[this.data?.medicamento?.nombre||"",c.kI.required],descripcion:[this.data?.medicamento?.descripcion||"",c.kI.required],dosis:[this.data?.medicamento?.dosis||"",c.kI.required]})}onCancel(){this.dialogRef.close()}onSave(){this.medicamentoForm.valid&&this.agregarMedicamento()}agregarMedicamento(){this.medicamentoService.addMedicamento(this.medicamentoForm.value).subscribe(t=>{t.success&&h().fire({icon:"success",title:"\xa1Medicamento agregado!",text:"El medicamento se agreg\xf3 correctamente a la base de datos",confirmButtonText:"Ok"}).then(()=>{this.dialogRef.close(),window.location.reload()})},t=>{console.error("Error al agregar el medicamento",t),h().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al intentar agregar el medicamento. Por favor, int\xe9ntalo de nuevo.",confirmButtonText:"Ok"})})}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(l.so),e.Y36(c.qu),e.Y36(A),e.Y36(l.WI))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-medicamento-dialog"]],standalone:!0,features:[e.jDz],decls:24,vars:3,consts:[["mat-dialog-title",""],[1,"scrollable-content"],[3,"formGroup"],[1,"form-grid"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","nombre","required",""],["matInput","","formControlName","descripcion","required",""],["matInput","","formControlName","dosis","required",""],["align","end"],["mat-button","",3,"click"],["mat-button","","color","primary",3,"disabled","click"]],template:function(n,a){1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"div",3)(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),e._uU(8,"Nombre"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.TgZ(10,"mat-form-field",5)(11,"mat-label"),e._uU(12,"Descripci\xf3n"),e.qZA(),e._UZ(13,"input",7),e.qZA()(),e.TgZ(14,"div",4)(15,"mat-form-field",5)(16,"mat-label"),e._uU(17,"Dosis"),e.qZA(),e._UZ(18,"input",8),e.qZA()()()()(),e.TgZ(19,"mat-dialog-actions",9)(20,"button",10),e.NdJ("click",function(){return a.onCancel()}),e._uU(21,"Cancelar"),e.qZA(),e.TgZ(22,"button",11),e.NdJ("click",function(){return a.onSave()}),e._uU(23," Guardar "),e.qZA()()),2&n&&(e.xp6(),e.Oqu(a.data.medicamento?"Editar Medicamento":"Agregar Medicamento"),e.xp6(2),e.Q6J("formGroup",a.medicamentoForm),e.xp6(19),e.Q6J("disabled",a.medicamentoForm.invalid))},dependencies:[l.Is,l.uh,l.H8,l.xY,u.lN,u.KE,u.hX,C.c,C.Nt,p.ot,p.lW,c.UX,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.sg,c.u,x.ez],styles:['@charset "UTF-8";.scrollable-content[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;padding-right:16px}.form-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px}.form-field[_ngcontent-%COMP%]{flex:1}']})}return o})();var F=r(217),J=r(376);function Y(o,m){1&o&&(e.TgZ(0,"th",24),e._uU(1," ID "),e.qZA())}function q(o,m){if(1&o&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&o){const t=m.$implicit;e.xp6(),e.hij(" ",t.id_medicamento," ")}}function B(o,m){1&o&&(e.TgZ(0,"th",24),e._uU(1," Nombre "),e.qZA())}function Q(o,m){if(1&o&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&o){const t=m.$implicit;e.xp6(),e.hij(" ",t.nombre," ")}}function E(o,m){1&o&&(e.TgZ(0,"th",24),e._uU(1," Descripci\xf3n "),e.qZA())}function O(o,m){if(1&o&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&o){const t=m.$implicit;e.xp6(),e.hij(" ",t.descripcion," ")}}function R(o,m){1&o&&(e.TgZ(0,"th",24),e._uU(1," Dosis "),e.qZA())}function I(o,m){if(1&o&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&o){const t=m.$implicit;e.xp6(),e.hij(" ",t.dosis," ")}}function j(o,m){1&o&&(e.TgZ(0,"th",26),e._uU(1," Acciones "),e.qZA())}function k(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"td",25)(1,"button",27),e.NdJ("click",function(){const i=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.eliminarMedicamento(i.id_medicamento))}),e.TgZ(2,"mat-icon"),e._uU(3,"delete"),e.qZA()()()}}function G(o,m){1&o&&e._UZ(0,"tr",28)}function $(o,m){1&o&&e._UZ(0,"tr",29)}const z=()=>["Dashboards","Medicamentos"],P=()=>[5,10,20];let H=(()=>{class o{constructor(t,n,a){this.configService=t,this.medicamentoService=n,this.dialog=a,this.searchTerm="",this.displayedColumns=["id_medicamento","nombre","descripcion","dosis","acciones"],this.dataSource=new d.by}ngOnInit(){this.footerVisibleChange(!1),this.obtenerMedicamentos()}obtenerMedicamentos(){this.medicamentoService.getMedicamentos().subscribe(t=>{t&&Array.isArray(t.medicamentos)&&(this.dataSource.data=t.medicamentos,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)},t=>{console.error("Error al obtener los medicamentos",t),this.dataSource.data=[]})}applyFilter(){this.dataSource.filterPredicate=(t,n)=>t.nombre.toLowerCase().includes(this.searchTerm.toLowerCase()),this.dataSource.filter=this.searchTerm.trim().toLowerCase()}onSearchTermChange(){this.applyFilter()}footerVisibleChange(t){this.configService.updateConfig({footer:{visible:!1}})}generarReporte(){const t=this.dataSource.filteredData.map(i=>({ID:i.id_medicamento,Nombre:i.nombre,Descripci\u00f3n:i.descripcion,Dosis:i.dosis})),n=this.convertToCSV(t),a=new Blob([n],{type:"text/csv;charset=utf-8;"});(0,F.saveAs)(a,"reporte_medicamentos.csv")}convertToCSV(t){const n="object"!=typeof t?JSON.parse(t):t;let a="",i="";for(const s in n[0])n[0].hasOwnProperty(s)&&(i+=s+",");i=i.slice(0,-1),a+=i+"\r\n";for(let s=0;s<n.length;s++){let M="";for(const U in n[s])n[s].hasOwnProperty(U)&&(M+=n[s][U]+",");M=M.slice(0,-1),a+=M+"\r\n"}return a}openAddMedicamentoModal(){this.dialog.open(w,{width:"800px",data:{}}).afterClosed().subscribe(n=>{n&&this.obtenerMedicamentos()})}eliminarMedicamento(t){h().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"}).then(n=>{n.isConfirmed&&this.medicamentoService.deleteMedicamento(t).subscribe(()=>{h().fire("Eliminado","El medicamento ha sido eliminado correctamente.","success"),this.obtenerMedicamentos()},a=>{console.error("Error al eliminar el medicamento",a),h().fire("Error","Ocurri\xf3 un error al intentar eliminar el medicamento.","error")})})}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(J.Y),e.Y36(A),e.Y36(l.uw))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["vex-medicamentos"]],viewQuery:function(n,a){if(1&n&&(e.Gf(Z.NW,5),e.Gf(g.YE,5)),2&n){let i;e.iGM(i=e.CRH())&&(a.paginator=i.first),e.iGM(i=e.CRH())&&(a.sort=i.first)}},standalone:!0,features:[e.jDz],decls:47,vars:8,consts:[["current","Medicamentos"],[1,"flex-auto",3,"crumbs"],["color","primary","mat-icon-button","","type","button",1,"ml-2"],["svgIcon","mat:add"],[1,"container","p-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-semibold","text-gray-700"],["mat-flat-button","","color","primary",3,"click"],["appearance","outline"],["matInput","","placeholder","Buscar...",3,"ngModel","ngModelChange"],["matSuffix",""],["mat-flat-button","","color","accent",3,"click"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id_medicamento"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","descripcion"],["matColumnDef","dosis"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,a){1&n&&(e.TgZ(0,"vex-secondary-toolbar",0),e._UZ(1,"vex-breadcrumbs",1),e.TgZ(2,"button",2),e._UZ(3,"mat-icon",3),e.qZA()(),e.TgZ(4,"div",4)(5,"div",5)(6,"h2",6),e._uU(7,"Informaci\xf3n de Medicamentos"),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){return a.openAddMedicamentoModal()}),e.TgZ(9,"mat-icon"),e._uU(10,"add"),e.qZA(),e._uU(11," Agregar Medicamento "),e.qZA()(),e.TgZ(12,"mat-card")(13,"mat-card-header")(14,"mat-card-title"),e._uU(15,"B\xfasqueda de Medicamentos"),e.qZA()(),e.TgZ(16,"mat-card-content")(17,"div",5)(18,"mat-form-field",8)(19,"mat-label"),e._uU(20,"Buscar por nombre"),e.qZA(),e.TgZ(21,"input",9),e.NdJ("ngModelChange",function(s){return a.searchTerm=s})("ngModelChange",function(){return a.onSearchTermChange()}),e.qZA(),e.TgZ(22,"mat-icon",10),e._uU(23,"search"),e.qZA()(),e.TgZ(24,"button",11),e.NdJ("click",function(){return a.generarReporte()}),e.TgZ(25,"mat-icon"),e._uU(26,"download"),e.qZA(),e._uU(27," Generar Reporte "),e.qZA()(),e.TgZ(28,"table",12),e.ynx(29,13),e.YNc(30,Y,2,0,"th",14)(31,q,2,1,"td",15),e.BQk(),e.ynx(32,16),e.YNc(33,B,2,0,"th",14)(34,Q,2,1,"td",15),e.BQk(),e.ynx(35,17),e.YNc(36,E,2,0,"th",14)(37,O,2,1,"td",15),e.BQk(),e.ynx(38,18),e.YNc(39,R,2,0,"th",14)(40,I,2,1,"td",15),e.BQk(),e.ynx(41,19),e.YNc(42,j,2,0,"th",20)(43,k,4,0,"td",15),e.BQk(),e.YNc(44,G,1,0,"tr",21)(45,$,1,0,"tr",22),e.qZA(),e._UZ(46,"mat-paginator",23),e.qZA()()()),2&n&&(e.xp6(),e.Q6J("crumbs",e.DdM(6,z)),e.xp6(20),e.Q6J("ngModel",a.searchTerm),e.xp6(7),e.Q6J("dataSource",a.dataSource),e.xp6(16),e.Q6J("matHeaderRowDef",a.displayedColumns),e.xp6(),e.Q6J("matRowDefColumns",a.displayedColumns),e.xp6(),e.Q6J("pageSizeOptions",e.DdM(7,P)))},dependencies:[y.P,_.D,p.ot,p.lW,p.RK,b.Ps,b.Hw,d.p0,d.BZ,d.fO,d.as,d.w1,d.Dz,d.nj,d.ge,d.ev,d.XQ,d.Gk,f.QW,f.a8,f.dn,f.dk,f.n5,Z.TU,Z.NW,g.JX,g.YE,g.nU,u.lN,u.KE,u.hX,u.R9,C.c,C.Nt,D.LD,S.Ng,c.u5,c.Fj,c.JJ,c.On,x.ez,l.Is]})}return o})()}}]);